<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>POL1101 การเมืองและการปกครองไทย — 20nxskypqz Exam Review</title>

  <link href="https://fonts.googleapis.com/css2?family=Niramit:wght@400;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />

  <link rel="stylesheet" href="../styles.css" />
</head>
<body class="page-pol1101">
  <header class="header full-bleed">
    <button class="menu-toggle" id="menuToggle" aria-label="Toggle navigation" type="button">
      <span class="material-symbols-outlined">menu</span>
    </button>
    <div data-include="../shared/dark-mode-toggle.html"></div>
  </header>

  <div data-include="../shared/side-menu.html"></div>

  <main class="content">
    <section class="hero">
      <h3 class="hero-title">POL1101 – การเมืองและการปกครองไทย</h3>
    </section>

    <section class="section-card">
      <h4 style="text-align:center; margin:-5px 0 15px 0; font-weight: bold;">ภาค 1 ความนำทั่วไป</h4>
      <h2 class="align-left" style="margin:0 0 8px;">บทที่ 1 – การเมืองการปกครอง รูปแบบ ลักษณะ และลัทธิ</h2>
      <div class="card" id="pol-ch1-status" style="font-weight:700;color:#666;margin-bottom:8px;">Loading document…</div>
      <div class="card" id="pol-ch1-box">Preparing…</div>
      <h2 class="align-left" style="margin:20px 0 8px;">บทที่ 2 – หลักประชาธิปไตย</h2>
      <div class="card" id="pol-ch2-status" style="font-weight:700;color:#666;margin-bottom:8px;">Loading document…</div>
      <div class="card" id="pol-ch2-box">Preparing…</div>
    </section>

    <section class="section-card">
      <h4 style="text-align:center; margin:-5px 0 15px 0; font-weight: bold;">ภาค 2 ประวัติศาสตร์</h4>
      <h2 class="align-left" style="margin:0 0 8px;">บทที่ 3 – สุโขทัย อยุธยา รัตนโกสินทร์</h2>
      <div class="card" id="pol-ch3-status" style="font-weight:700;color:#666;margin-bottom:8px;">Loading document…</div>
      <div class="card" id="pol-ch3-box">Preparing…</div>
      <h2 class="align-left" style="margin:20px 0 8px;">บทที่ 4 – ปฏิวัติ 24 มิถุนายน 2475</h2>
      <div class="card" id="pol-ch4-status" style="font-weight:700;color:#666;margin-bottom:8px;">Loading document…</div>
      <div class="card" id="pol-ch4-box">Preparing…</div>
      <h2 class="align-left" style="margin:20px 0 8px;">บทที่ 5 – กบฏ ปฏิวัติ รัฐประหาร</h2>
      <div class="card" id="pol-ch5-status" style="font-weight:700;color:#666;margin-bottom:8px;">Loading document…</div>
      <div class="card" id="pol-ch5-box">Preparing…</div>
    </section>

    <section class="section-card">
      <h4 style="text-align:center; margin:-5px 0 15px 0; font-weight: bold;">ภาค 3 สถาบัน</h4>
      <h2 class="align-left" style="margin:0 0 8px;">บทที่ 6 – รัฐธรรมนูญ</h2>
      <div class="card" id="pol-ch6-status" style="font-weight:700;color:#666;margin-bottom:8px;">Loading document…</div>
      <div class="card" id="pol-ch6-box">Preparing…</div>
      <h2 class="align-left" style="margin:20px 0 8px;">บทที่ 7 – พระมหากษัตริย์</h2>
      <div class="card" id="pol-ch7-status" style="font-weight:700;color:#666;margin-bottom:8px;">Loading document…</div>
      <div class="card" id="pol-ch7-box">Preparing…</div>
      <h2 class="align-left" style="margin:20px 0 8px;">บทที่ 8 – คณะรัฐมนตรี</h2>
      <div class="card" id="pol-ch8-status" style="font-weight:700;color:#666;margin-bottom:8px;">Loading document…</div>
      <div class="card" id="pol-ch8-box">Preparing…</div>
      <h2 class="align-left" style="margin:20px 0 8px;">บทที่ 9 – รัฐสภา</h2>
      <div class="card" id="pol-ch9-status" style="font-weight:700;color:#666;margin-bottom:8px;">Loading document…</div>
      <div class="card" id="pol-ch9-box">Preparing…</div>
      <h2 class="align-left" style="margin:20px 0 8px;">บทที่ 10 – การบัญญัติกฎหมาย</h2>
      <div class="card" id="pol-ch10-status" style="font-weight:700;color:#666;margin-bottom:8px;">Loading document…</div>
      <div class="card" id="pol-ch10-box">Preparing…</div>
      <h2 class="align-left" style="margin:20px 0 8px;">บทที่ 11 – ตุลาการ</h2>
      <div class="card" id="pol-ch11-status" style="font-weight:700;color:#666;margin-bottom:8px;">Loading document…</div>
      <div class="card" id="pol-ch11-box">Preparing…</div>
      <h2 class="align-left" style="margin:20px 0 8px;">บทที่ 12 – พรรคการเมือง</h2>
      <div class="card" id="pol-ch12-status" style="font-weight:700;color:#666;margin-bottom:8px;">Loading document…</div>
      <div class="card" id="pol-ch12-box">Preparing…</div>
      <h2 class="align-left" style="margin:20px 0 8px;">บทที่ 13 – กลุ่มผลประโยชน์</h2>
      <div class="card" id="pol-ch13-status" style="font-weight:700;color:#666;margin-bottom:8px;">Loading document…</div>
      <div class="card" id="pol-ch13-box">Preparing…</div>
      <h2 class="align-left" style="margin:20px 0 8px;">บทที่ 14 – การเลือกตั้ง</h2>
      <div class="card" id="pol-ch14-status" style="font-weight:700;color:#666;margin-bottom:8px;">Loading document…</div>
      <div class="card" id="pol-ch14-box">Preparing…</div>
    </section>

    <section class="section-card">
        <h4 style="text-align:center; margin:-5px 0 15px 0; font-weight: bold;">ภาค 4 ระเบียบบริหารราชการแผ่นดิน</h4>
        <h2 class="align-left" style="margin:0 0 8px;">บทที่ 15 – การบริหารราชการ</h2>
        <div class="card" id="pol-ch15-status" style="font-weight:700;color:#666;margin-bottom:8px;">Loading document…</div>
        <div class="card" id="pol-ch15-box">Preparing…</div>
        <h2 class="align-left" style="margin:20px 0 8px;">บทที่ 16 – ระเบียบบริหารราชการส่วนกลาง</h2>
        <div class="card" id="pol-ch16-status" style="font-weight:700;color:#666;margin-bottom:8px;">Loading document…</div>
        <div class="card" id="pol-ch16-box">Preparing…</div>
        <h2 class="align-left" style="margin:20px 0 8px;">บทที่ 17 – การปกครองส่วนภูมิภาค</h2>
        <div class="card" id="pol-ch17-status" style="font-weight:700;color:#666;margin-bottom:8px;">Loading document…</div>
        <div class="card" id="pol-ch17-box">Preparing…</div>
        <h2 class="align-left" style="margin:20px 0 8px;">บทที่ 18 – การปกครองส่วนท้องถิ่น (ตอนที่ 1)</h2>
        <div class="card" id="pol-ch18-status" style="font-weight:700;color:#666;margin-bottom:8px;">Loading document…</div>
        <div class="card" id="pol-ch18-box">Preparing…</div>
        <h2 class="align-left" style="margin:20px 0 8px;">บทที่ 19 – การปกครองส่วนท้องถิ่น (ตอนที่ 2)</h2>
        <div class="card" id="pol-ch19-status" style="font-weight:700;color:#666;margin-bottom:8px;">Loading document…</div>
        <div class="card" id="pol-ch19-box">Preparing…</div>
    </section>

  </main>

  <footer class="footer full-bleed">&copy; 2025 20nxskypqz Exam Review</footer>

  <script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>
  <script src="../script.js"></script>
  <script>
    // ฟังก์ชัน helper (เหมือนเดิม)
    function normalizeHeadingsByFont(container){ /* ... */ }
    function fixListSpacing(container){ /* ... */ }
    async function loadArrayBuffer(url){ /* ... */ } // ใช้เวอร์ชันล่าสุดที่มี log ละเอียด
    const options = { /* ... */ };

    // *** EDITED: ฟังก์ชัน restructureIndentedParagraphs เวอร์ชั่นใหม่ (ทำงานกับทุก P) ***
    function restructureIndentedParagraphs(container) {
        console.log("[Restructure V2] Starting...");
        const elements = Array.from(container.children); // ใช้ children เพื่อให้ได้เฉพาะ element ลูกตรงๆ
        let currentListStack = []; // Stack เก็บ [ulElement, level]
        let lastLi = null;         // li ล่าสุดที่เพิ่มเข้าไป
        let lastLevel = -1;        // Level ของ element ก่อนหน้า (-1 คือยังไม่เริ่ม list)
        const indentThreshold = 30; // ค่า pt โดยประมาณ (อาจต้องปรับ)

        function getIndentLevel(element) {
            if (element.tagName !== 'P') return -1; // สนใจแค่ P
            const style = element.getAttribute('style') || '';
            let indent = 0;
            const ptMatch = style.match(/(?:margin|padding)-left:\s*([\d.]+)pt/i);
            const pxMatch = style.match(/(?:margin|padding)-left:\s*([\d.]+)px/i);
            if (ptMatch) indent = parseFloat(ptMatch[1]);
            else if (pxMatch) indent = parseFloat(pxMatch[1]) * (72 / 96);

            // Level 0 คือไม่มีการเยื้อง หรือเยื้องน้อยมาก
            // Level 1 คือเยื้องประมาณ indentThreshold, Level 2 คือ 2*indentThreshold,...
            return Math.max(0, Math.round(indent / indentThreshold));
        }

        const fragment = document.createDocumentFragment(); // สร้าง fragment เพื่อเก็บผลลัพธ์ชั่วคราว
        let listActive = false; // Flag ว่ากำลังอยู่ใน list หรือไม่

        elements.forEach(el => {
            const currentLevel = getIndentLevel(el);

            if (currentLevel >= 0) { // ถ้าเป็น P และมีการเยื้อง (หรือไม่มีเลย)
                listActive = true; // เริ่มเข้าสู่โหมด list
                console.log(`[Restructure V2] P: "${el.textContent.substring(0,20)}..." -> Level: ${currentLevel}`);
                const newLi = document.createElement('li');
                while (el.firstChild) { newLi.appendChild(el.firstChild); }

                if (currentLevel > lastLevel) {
                    // เยื้องเข้า: สร้าง UL ใหม่ซ้อนใน LI เก่า (ถ้ามี LI เก่า)
                    if (!lastLi) { // กรณีเป็นรายการแรกสุด
                         console.log("[Restructure V2]   First item or indenting without parent LI.");
                         // สร้าง UL ใหม่ถ้ายังไม่มีใน stack หรือ level ปัจจุบันยังไม่มี UL
                         if (currentListStack.length === 0 || currentListStack[currentListStack.length-1][1] < currentLevel) {
                              const newUl = document.createElement('ul');
                              // ถ้ามี UL อยู่แล้วใน stack ให้ซ้อนเข้าไป
                              if (currentListStack.length > 0) {
                                   const [parentUl, parentLevel] = currentListStack[currentListStack.length-1];
                                   // หา li สุดท้ายของ parentUl เพื่อ append ul ใหม่ (ควรจะเป็น lastLi แต่เผื่อไว้)
                                   const parentLastLi = parentUl.lastElementChild;
                                   if (parentLastLi && parentLastLi.tagName === 'LI') {
                                        parentLastLi.appendChild(newUl);
                                   } else {
                                        console.warn("[Restructure V2] Cannot find parent LI to append nested UL.");
                                        parentUl.appendChild(newUl); // fallback append ที่ UL แม่
                                   }
                              } else {
                                   fragment.appendChild(newUl); // UL แรกสุด เพิ่มเข้า fragment
                              }
                              currentListStack.push([newUl, currentLevel]);
                              console.log("[Restructure V2]   Created new UL at level", currentLevel);
                         } else {
                              // ใช้ UL เดิมที่ level ตรงกัน
                              currentUl = currentListStack[currentListStack.length-1][0];
                         }
                    } else {
                        const newUl = document.createElement('ul');
                        lastLi.appendChild(newUl);
                        currentListStack.push([newUl, currentLevel]);
                        console.log("[Restructure V2]   Indent increased. Created new UL inside LI.");
                    }
                } else if (currentLevel < lastLevel) {
                    // ถอยออก: Pop stack จนเจอ level ที่ถูกต้อง
                    while (currentListStack.length > 0 && currentListStack[currentListStack.length-1][1] > currentLevel) {
                        currentListStack.pop();
                    }
                     console.log("[Restructure V2]   Indent decreased. Popped stack to level", currentLevel);
                } else {
                     console.log("[Restructure V2]   Same level.");
                }

                // หา UL ปัจจุบันจาก stack
                let currentUl;
                if (currentListStack.length > 0) {
                    currentUl = currentListStack[currentListStack.length - 1][0];
                } else {
                    // กรณีแปลกๆ ที่ไม่มี stack เหลือ ให้สร้าง UL ใหม่ที่ root
                    console.warn("[Restructure V2] No UL in stack, creating new root UL.");
                    currentUl = document.createElement('ul');
                    fragment.appendChild(currentUl);
                    currentListStack.push([currentUl, 0]); // สมมติเป็น level 0
                }

                // เพิ่ม LI เข้า UL ปัจจุบัน
                currentUl.appendChild(newLi);
                lastLi = newLi;
                lastLevel = currentLevel;

            } else { // ถ้าไม่ใช่ P หรือไม่มีการเยื้องที่ต้องจัดการ
                // ถ้าเคยอยู่ใน list ให้ปิด list นั้น (เคลียร์ stack)
                if (listActive) {
                    console.log("[Restructure V2] Exiting list mode.");
                    currentListStack = [];
                    lastLi = null;
                    lastLevel = -1;
                    listActive = false;
                }
                // ย้าย element เดิมเข้า fragment โดยตรง
                fragment.appendChild(el);
            }
        });

        // เคลียร์ container เดิม แล้วใส่ fragment ที่สร้างใหม่เข้าไป
        console.log("[Restructure V2] Replacing content.");
        container.innerHTML = '';
        container.appendChild(fragment);
        console.log("[Restructure V2] Finished.");
    }


    function makeDocLoader(fileUrl, statusId, boxId){
      const statusEl = document.getElementById(statusId);
      const boxEl    = document.getElementById(boxId);
      if (!statusEl || !boxEl) { /* ... */ return; }
      (async () => {
        const fullFileUrl = `files/${fileUrl}`;
        /* ... ส่วนโหลดไฟล์ ... */
        try{
          const buf = await loadArrayBuffer(fullFileUrl);
          /* ... ตรวจสอบ buf ... */
          const { value: html } = await window.mammoth.convertToHtml({ arrayBuffer: buf }, options);
          boxEl.innerHTML = html; // แสดง HTML ดิบก่อน

          console.log(`[Loader] Running post-processing for ${fullFileUrl}`);
          normalizeHeadingsByFont(boxEl); // ทำงานเหมือนเดิม
          fixListSpacing(boxEl); // ทำงานเหมือนเดิม

          // *** EDITED: เรียก restructureIndentedParagraphs เสมอ ***
          restructureIndentedParagraphs(boxEl); // ไม่ต้องมี if แล้ว ทำงานทุกไฟล์

          statusEl.textContent = 'Done.';
          console.log(`[Loader] Successfully loaded and rendered: ${fullFileUrl}`);
        } catch(e) { /* ... */ }
      })();
    }

    // เรียกโหลดไฟล์ (เหมือนเดิม)
    makeDocLoader("บทที่ 1 การเมืองการปกครอง รูปแบบ ลักษณะ และลัทธิ.docx", "pol-ch1-status", "pol-ch1-box");
    // ... (เรียกไฟล์อื่นๆ บทที่ 2 ถึง 18) ...
    makeDocLoader("บทที่ 19 การปกครองส่วนท้องถิ่น (ตอนที่ 2).docx", "pol-ch19-status", "pol-ch19-box");

  </script>
</body>
</html>
