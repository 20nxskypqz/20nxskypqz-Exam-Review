<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>POL1101 การเมืองและการปกครองไทย — 20nxskypqz Exam Review</title>

  <link href="https://fonts.googleapis.com/css2?family=Niramit:wght@400;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
  <link rel="stylesheet" href="../styles.css" />

  <style>
    body{font-family:"Niramit",system-ui,-apple-system,Segoe UI,Roboto,Arial,"TH Sarabun New",sans-serif;line-height:1.6}
    .content{max-width:1100px;margin:0 auto;padding:16px}
    .card{background:#fff;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,.05);padding:16px}
    .section-card{margin:24px 0}
    .align-left{text-align:left}
    .status-ok{color:#2e7d32;font-weight:700}
    .status-warn{color:#f57c00;font-weight:700}
    .status-err{color:#c62828;font-weight:700}
    .status-dim{color:#666;font-weight:700}

    p{margin:.4em 0 .8em; text-indent:0}
    /* ป้องกันสไตล์ global รีเซ็ตลิสต์: ใส่คลาส g-list แล้วบังคับด้วย !important */
    .g-list{ list-style-position: outside !important; padding-left: 1.6em !important; margin: .2em 0 .6em 0 !important; }
    .g-list ul{ padding-left: 1.6em !important; margin: .15em 0 .5em 0 !important; }
    .g-list{ list-style-type: disc; }
    .g-list.g-lv1{ list-style-type: circle; }
    .g-list.g-lv2{ list-style-type: square; }

    table{border-collapse:collapse;width:100%;margin:12px 0}
    th,td{border:1px solid #e0e0e0;padding:8px;vertical-align:top}
    .small-note{color:#666}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
  </style>
</head>
<body class="page-pol1101">
  <header class="header full-bleed">
    <button class="menu-toggle" id="menuToggle" aria-label="Toggle navigation" type="button">
      <span class="material-symbols-outlined">menu</span>
    </button>
    <div data-include="../shared/dark-mode-toggle.html"></div>
  </header>

  <div data-include="../shared/side-menu.html"></div>

  <main class="content">
    <section class="hero">
      <h3 class="hero-title">POL1101 – การเมืองและการปกครองไทย</h3>
    </section>

    <section class="section-card">
      <h4 style="text-align:center; margin:-5px 0 15px 0; font-weight: bold;">ภาค 1 ความนำทั่วไป</h4>
      <h2 class="align-left" style="margin:0 0 8px;">บทที่ 1 – การเมืองการปกครอง รูปแบบ ลักษณะ และลัทธิ</h2>
      <div class="card status-dim" id="pol-ch1-status">Loading document…</div>
      <div class="card" id="pol-ch1-box">Preparing…</div>

      <h2 class="align-left" style="margin:20px 0 8px;">บทที่ 2 – หลักประชาธิปไตย</h2>
      <div class="card status-dim" id="pol-ch2-status">Loading document…</div>
      <div class="card" id="pol-ch2-box">Preparing…</div>
    </section>

    <section class="section-card">
      <h4 style="text-align:center; margin:-5px 0 15px 0; font-weight: bold;">ภาค 2 ประวัติศาสตร์</h4>
      <h2 class="align-left" style="margin:0 0 8px;">บทที่ 3 – สุโขทัย อยุธยา รัตนโกสินทร์</h2>
      <div class="card status-dim" id="pol-ch3-status">Loading document…</div>
      <div class="card" id="pol-ch3-box">Preparing…</div>

      <h2 class="align-left" style="margin:20px 0 8px;">บทที่ 4 – ปฏิวัติ 24 มิถุนายน 2475</h2>
      <div class="card status-dim" id="pol-ch4-status">Loading document…</div>
      <div class="card" id="pol-ch4-box">Preparing…</div>

      <h2 class="align-left" style="margin:20px 0 8px;">บทที่ 5 – กบฏ ปฏิวัติ รัฐประหาร</h2>
      <div class="card status-dim" id="pol-ch5-status">Loading document…</div>
      <div class="card" id="pol-ch5-box">Preparing…</div>
    </section>

    <section class="section-card">
      <h4 style="text-align:center; margin:-5px 0 15px 0; font-weight: bold;">ภาค 3 สถาบัน</h4>
      <h2 class="align-left" style="margin:0 0 8px;">บทที่ 6 – รัฐธรรมนูญ</h2>
      <div class="card status-dim" id="pol-ch6-status">Loading document…</div>
      <div class="card" id="pol-ch6-box">Preparing…</div>
      <h2 class="align-left" style="margin:20px 0 8px;">บทที่ 7 – พระมหากษัตริย์</h2>
      <div class="card status-dim" id="pol-ch7-status">Loading document…</div>
      <div class="card" id="pol-ch7-box">Preparing…</div>
      <h2 class="align-left" style="margin:20px 0 8px;">บทที่ 8 – คณะรัฐมนตรี</h2>
      <div class="card status-dim" id="pol-ch8-status">Loading document…</div>
      <div class="card" id="pol-ch8-box">Preparing…</div>
      <h2 class="align-left" style="margin:20px 0 8px;">บทที่ 9 – รัฐสภา</h2>
      <div class="card status-dim" id="pol-ch9-status">Loading document…</div>
      <div class="card" id="pol-ch9-box">Preparing…</div>
      <h2 class="align-left" style="margin:20px 0 8px;">บทที่ 10 – การบัญญัติกฎหมาย</h2>
      <div class="card status-dim" id="pol-ch10-status">Loading document…</div>
      <div class="card" id="pol-ch10-box">Preparing…</div>
      <h2 class="align-left" style="margin:20px 0 8px;">บทที่ 11 – ตุลาการ</h2>
      <div class="card status-dim" id="pol-ch11-status">Loading document…</div>
      <div class="card" id="pol-ch11-box">Preparing…</div>
      <h2 class="align-left" style="margin:20px 0 8px;">บทที่ 12 – พรรคการเมือง</h2>
      <div class="card status-dim" id="pol-ch12-status">Loading document…</div>
      <div class="card" id="pol-ch12-box">Preparing…</div>
      <h2 class="align-left" style="margin:20px 0 8px;">บทที่ 13 – กลุ่มผลประโยชน์</h2>
      <div class="card status-dim" id="pol-ch13-status">Loading document…</div>
      <div class="card" id="pol-ch13-box">Preparing…</div>
      <h2 class="align-left" style="margin:20px 0 8px;">บทที่ 14 – การเลือกตั้ง</h2>
      <div class="card status-dim" id="pol-ch14-status">Loading document…</div>
      <div class="card" id="pol-ch14-box">Preparing…</div>
    </section>

    <section class="section-card">
      <h4 style="text-align:center; margin:-5px 0 15px 0; font-weight: bold;">ภาค 4 ระเบียบบริหารราชการแผ่นดิน</h4>
      <h2 class="align-left" style="margin:0 0 8px;">บทที่ 15 – การบริหารราชการ</h2>
      <div class="card status-dim" id="pol-ch15-status">Loading document…</div>
      <div class="card" id="pol-ch15-box">Preparing…</div>
      <h2 class="align-left" style="margin:20px 0 8px;">บทที่ 16 – ระเบียบบริหารราชการส่วนกลาง</h2>
      <div class="card status-dim" id="pol-ch16-status">Loading document…</div>
      <div class="card" id="pol-ch16-box">Preparing…</div>
      <h2 class="align-left" style="margin:20px 0 8px;">บทที่ 17 – การปกครองส่วนภูมิภาค</h2>
      <div class="card status-dim" id="pol-ch17-status">Loading document…</div>
      <div class="card" id="pol-ch17-box">Preparing…</div>
      <h2 class="align-left" style="margin:20px 0 8px;">บทที่ 18 – การปกครองส่วนท้องถิ่น (ตอนที่ 1)</h2>
      <div class="card status-dim" id="pol-ch18-status">Loading document…</div>
      <div class="card" id="pol-ch18-box">Preparing…</div>
      <h2 class="align-left" style="margin:20px 0 8px;">บทที่ 19 – การปกครองส่วนท้องถิ่น (ตอนที่ 2)</h2>
      <div class="card status-dim" id="pol-ch19-status">Loading document…</div>
      <div class="card" id="pol-ch19-box">Preparing…</div>
    </section>
  </main>

  <footer class="footer full-bleed">&copy; 2025 20nxskypqz Exam Review</footer>

  <script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>
  <script src="../script.js"></script>

  <script>
    function setStatus(el, text, cls){
      if(!el) return;
      el.textContent = text;
      el.classList.remove('status-ok','status-warn','status-err','status-dim');
      if (cls) el.classList.add(cls);
    }
    function humanFileSize(bytes){if(isNaN(bytes))return"?";const k=1024; if(Math.abs(bytes)<k)return bytes+' B'; const u=['KB','MB','GB'];let i=-1;do{bytes/=k;++i}while(Math.abs(bytes)>=k&&i<u.length-1);return bytes.toFixed(1)+' '+u[i];}
    async function loadArrayBuffer(url){
      const res = await fetch(url+(url.includes('?')?'&':'?')+'_ts='+Date.now(), {cache:'no-store'});
      if(!res.ok) throw new Error(`HTTP ${res.status} – โหลดไม่ได้: ${url}`);
      return await res.arrayBuffer();
    }

    // ไม่โปรโมตหัวข้อ เพื่อไม่กระทบขนาด
    function normalizeHeadingsByStrong(){}

    // >>> เวอร์ชันใหม่: สร้าง "ซ้อน" UL ภายใน LI ของระดับก่อนหน้าเสมอ <<<
    function normalizeLists(root){
      if(!root) return;
      const BULLET_RE = /^([•◦○▪■\-–—])\s+/;
      const bulletStyleMap = { '•':'disc', '◦':'circle', '○':'circle', '▪':'square', '■':'square', '-':'disc', '–':'disc', '—':'disc' };
      const symbolLevelHint = {'•':0,'-':0,'–':0,'—':0,'◦':1,'○':1,'▪':2,'■':2};

      const unitToPx = (val, unit) => {
        const dpi = 96;
        switch((unit||'').toLowerCase()){
          case 'px': return val;
          case 'pt': return val*(96/72);
          case 'cm': return val*(dpi/2.54);
          case 'mm': return val*(dpi/25.4);
          case 'in': return val*dpi;
          default: return val;
        }
      };
      const getLevelByStyle = (el) => {
        const style = el.getAttribute && el.getAttribute('style') || '';
        const m = /margin-left:\s*([\d\.]+)(cm|mm|in|px|pt)/i.exec(style);
        if(!m) return null;
        const px = unitToPx(parseFloat(m[1]), m[2]);
        return Math.min(6, Math.max(0, Math.round(px/24)));
      };
      const getLevelByWhitespace = (text) => {
        const m = text.match(/^(?:\u00a0|\t| ){1,}/);
        if(!m) return 0;
        const n = m[0].replace(/\t/g,'  ').length;
        return Math.min(6, Math.floor(n/2));
      };

      const paras = Array.from(root.querySelectorAll('p'));
      // สแตกเก็บโครงสร้างจริง: [{ul, lastLi}]
      const stack = [];

      const createUL = (parent, level, styleType) => {
        const ul = document.createElement('ul');
        ul.classList.add('g-list', level===0?'':'g-lv'+level);
        ul.style.listStyleType = styleType || (level===0?'disc':level===1?'circle':'square');
        ul.style.paddingLeft = '1.6em';
        ul.style.margin = '.2em 0 .6em 0';
        if(parent) parent.appendChild(ul);
        return ul;
      };

      let converted = 0;

      paras.forEach(p=>{
        const raw = p.textContent || "";
        if(!raw.trim()){ // เว้นวรรคล้วน: ตัดสแตก
          stack.length = 0;
          return;
        }
        const m = BULLET_RE.exec(raw);
        if(!m){
          stack.length = 0; // ไม่ใช่ bullet → จบกลุ่มลิสต์
          return;
        }

        // คำนวนระดับ
        let level = getLevelByStyle(p);
        if(level === null) level = getLevelByWhitespace(raw);
        const sym = m[1];
        if(symbolLevelHint[sym] != null && level < symbolLevelHint[sym]) level = symbolLevelHint[sym];

        // ทำให้แน่ใจว่ามีระดับที่ต้องการ โดย "ซ้อน" ภายใน lastLi ของระดับก่อนหน้า
        while(stack.length <= level){
          if(stack.length === 0){
            // สร้าง UL ระดับ 0 วางก่อน p
            const ul0 = createUL(null, 0, bulletStyleMap[sym]);
            p.parentNode.insertBefore(ul0, p);
            stack.push({ ul: ul0, lastLi: null });
          }else{
            const prev = stack[stack.length-1];
            // ต้องมี lastLi; ถ้าไม่มี ให้สร้าง li เปล่ารองรับ
            if(!prev.lastLi){
              prev.lastLi = document.createElement('li');
              prev.ul.appendChild(prev.lastLi);
            }
            // สร้าง UL ชั้นถัดไป "ภายใน lastLi" ของระดับก่อนหน้า
            const ulN = createUL(prev.lastLi, stack.length, bulletStyleMap[sym]);
            stack.push({ ul: ulN, lastLi: null });
          }
        }
        // ถ้ามีระดับเกินที่ต้องการ ให้ตัดทิ้ง
        while(stack.length > level+1) stack.pop();

        // สร้าง LI จาก p (คง inline nodes)
        const li = document.createElement('li');
        const frag = document.createDocumentFragment();
        Array.from(p.childNodes).forEach((node, idx)=>{
          if(idx===0 && node.nodeType===Node.TEXT_NODE){
            const after = node.textContent.replace(BULLET_RE,'').replace(/^\u00a0+/,'');
            frag.appendChild(document.createTextNode(after));
          }else{
            frag.appendChild(node.cloneNode(true));
          }
        });
        li.appendChild(frag);

        // ใส่ลง UL ของระดับปัจจุบัน
        const curr = stack[level];
        curr.ul.appendChild(li);
        curr.lastLi = li;

        // ลบ p เดิม
        p.remove();
        converted++;
      });

      if(converted){
        // เก็บกวาด p ว่างแปะรอบลิสต์
        root.querySelectorAll('p').forEach(pp=>{
          if(!pp.textContent.trim() && (pp.previousElementSibling?.matches('ul,ol') || pp.nextElementSibling?.matches('ul,ol'))){
            pp.remove();
          }
        });
      }
      console.log(`[NormalizeLists:NESTED] Converted ${converted} paragraphs -> nested list items.`);
    }

    function fixListSpacing(container){
      if(!container) return;
      container.querySelectorAll('ul,ol').forEach(list=>{
        if(!list.classList.contains('g-list')) return; // เราคุมเฉพาะที่เราสร้าง
        if(!list.style.marginTop) list.style.marginTop = '.2em';
        if(!list.style.marginBottom) list.style.marginBottom = '.6em';
        if(!list.style.paddingLeft) list.style.paddingLeft = '1.6em';
      });
    }

    const options = {
      styleMap: [
        "p[style-name='Title'] => p:fresh",
        "p[style-name='Subtitle'] => p:fresh",
        "u => u",
        "strike => s"
      ],
      includeEmbeddedStyleMap: true,
      convertImage: mammoth.images.inline(function(element) {
        return element.read("base64").then(function(imageBuffer) {
          return { src: "data:" + element.contentType + ";base64," + imageBuffer };
        });
      })
    };

    function makeDocLoader(fileName, statusId, boxId){
      const statusEl = document.getElementById(statusId);
      const boxEl    = document.getElementById(boxId);
      if (!statusEl || !boxEl) return;

      (async () => {
        const url = `files/${fileName}`;
        setStatus(statusEl, `Loading: ${fileName}`, 'status-dim');
        boxEl.innerHTML = '<span class="small-note mono">Preparing…</span>';

        try{
          if(!window.mammoth){
            setStatus(statusEl,'ไม่พบ Mammoth.js (CDN อาจถูกบล็อก/ออฟไลน์)', 'status-err');
            boxEl.innerHTML = '<div class="small-note">Cannot start conversion because mammoth is not loaded.</div>';
            return;
          }
          const buf = await loadArrayBuffer(url);
          setStatus(statusEl, `Converting (${humanFileSize(buf.byteLength)})…`, 'status-dim');

          const result = await window.mammoth.convertToHtml({ arrayBuffer: buf }, options);
          const html   = result.value;
          const notes  = result.messages || [];

          boxEl.innerHTML = html;

          normalizeHeadingsByStrong(boxEl); // (ว่าง)
          normalizeLists(boxEl);            // <-- เวอร์ชัน NESTED ใหม่
          fixListSpacing(boxEl);

          if (notes.length){
            setStatus(statusEl, `Done with notes (${notes.length}).`, 'status-warn');
            console.log(`[Mammoth Notes] ${fileName}`, notes);
          }else{
            setStatus(statusEl, 'Done.', 'status-ok');
          }
        }catch(e){
          console.error(e);
          setStatus(statusEl, `Error: ${e.message}`, 'status-err');
          boxEl.innerHTML = `<div class="small-note">โหลด/แปลงไม่สำเร็จ: <span class="mono">${e.message}</span></div>`;
        }
      })();
    }

    document.addEventListener('DOMContentLoaded', () => {
      // ภาค 1
      makeDocLoader("บทที่ 1 การเมืองการปกครอง รูปแบบ ลักษณะ และลัทธิ.docx", "pol-ch1-status", "pol-ch1-box");
      makeDocLoader("บทที่ 2 หลักประชาธิปไตย.docx", "pol-ch2-status", "pol-ch2-box");

      // ภาค 2
      makeDocLoader("บทที่ 3 สุโขทัย อยุธยา รัตนโกสินทร์.docx", "pol-ch3-status", "pol-ch3-box");
      makeDocLoader("บทที่ 4 ปฏิวัติ 24 มิถุนายน 2475.docx", "pol-ch4-status", "pol-ch4-box");
      makeDocLoader("บทที่ 5 กบฏ ปฏิวัติ รัฐประหาร.docx", "pol-ch5-status", "pol-ch5-box");

      // ภาค 3
      makeDocLoader("บทที่ 6 รัฐธรรมนูญ.docx", "pol-ch6-status", "pol-ch6-box");
      makeDocLoader("บทที่ 7 พระมหากษัตริย์.docx", "pol-ch7-status", "pol-ch7-box");
      makeDocLoader("บทที่ 8 คณะรัฐมนตรี.docx", "pol-ch8-status", "pol-ch8-box");
      makeDocLoader("บทที่ 9 รัฐสภา.docx", "pol-ch9-status", "pol-ch9-box");
      makeDocLoader("บทที่ 10 การบัญญัติกฎหมาย.docx", "pol-ch10-status", "pol-ch10-box");
      makeDocLoader("บทที่ 11 ตุลาการ.docx", "pol-ch11-status", "pol-ch11-box");
      makeDocLoader("บทที่ 12 พรรคการเมือง.docx", "pol-ch12-status", "pol-ch12-box");
      makeDocLoader("บทที่ 13 กลุ่มผลประโยชน์.docx", "pol-ch13-status", "pol-ch13-box");
      makeDocLoader("บทที่ 14 การเลือกตั้ง.docx", "pol-ch14-status", "pol-ch14-box");

      // ภาค 4
      makeDocLoader("บทที่ 15 การบริหารราชการ.docx", "pol-ch15-status", "pol-ch15-box");
      makeDocLoader("บทที่ 16 ระเบียบบริหารราชการส่วนกลาง.docx", "pol-ch16-status", "pol-ch16-box");
      makeDocLoader("บทที่ 17 การปกครองส่วนภูมิภาค.docx", "pol-ch17-status", "pol-ch17-box");
      makeDocLoader("บทที่ 18 การปกครองส่วนท้องถิ่น (ตอนที่ 1).docx", "pol-ch18-status", "pol-ch18-box");
      makeDocLoader("บทที่ 19 การปกครองส่วนท้องถิ่น (ตอนที่ 2).docx", "pol-ch19-status", "pol-ch19-box");
    });
  </script>
</body>
</html>