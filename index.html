<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>20nxskypqz Exam Review</title>

  <!-- ฟอนต์ Niramit -->
  <link href="https://fonts.googleapis.com/css2?family=Niramit:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root { --bg:#f9f9f9; --card:#fff; --ink:#111; --shadow:0 6px 24px rgba(0,0,0,.08); }
    * { box-sizing: border-box; }
    body {
      margin: 0; background: var(--bg); color: var(--ink);
      font-family: 'Niramit', system-ui, -apple-system, Segoe UI, Arial, sans-serif;
      line-height: 1.8; padding: 20px;
    }

    /* หัวเว็บ (ยังให้อยู่กึ่งกลาง) */
    h1, h2 { text-align: center; margin: 0 0 10px 0; font-weight: 700; }
    .docTitle { text-align: center; font-weight: 700; margin: 16px auto 8px; font-size: 22px; }

    .toolbar { max-width: 960px; margin: 0 auto 12px; display: flex; gap: 8px; justify-content: flex-end; }
    .btn { appearance:none; border:1px solid #111; background:#111; color:#fff; border-radius:999px; padding:8px 12px; font-weight:700; cursor:pointer; }
    .btn.alt { background:#fff; color:#111; }

    #status { text-align:center; font-size:14px; opacity:.75; margin:8px 0 16px; }
    #content {
      max-width: 960px; margin: 0 auto 24px; background: var(--card);
      border-radius: 12px; box-shadow: var(--shadow); padding: 24px;
    }

    /* ---------- สไตล์ภายในเอกสาร ---------- */
    /* หัวข้อในเอกสาร (ที่มาจากขนาด ~25/20 → map เป็น h1/h2/h3) ให้ชิดซ้าย */
    #content h1, #content h2, #content h3 { text-align: left; }

    #content h1 { font-size: 28px; font-weight: 700; margin: 18px 0 8px; }
    #content h2 { font-size: 24px; font-weight: 700; margin: 16px 0 6px; }
    #content h3 { font-size: 20px; font-weight: 700; margin: 14px 0 6px; }
    #content p  { margin: 8px 0; }
    #content strong { font-weight: 700; }
    #content em { font-style: italic; }
    #content ul, #content ol { padding-left: 1.4em; margin: 8px 0; }
    #content li { margin: 4px 0; }
  </style>
</head>
<body>
  <h1>Welcome to</h1>
  <h2>20nxskypqz Exam Review</h2>
  <div class="docTitle">สังคมศึกษา ม.4_1-68</div>

  <div class="toolbar">
    <button id="downloadHtml" class="btn alt">Download as HTML</button>
  </div>

  <div id="status">Loading DOCX…</div>
  <div id="content">Preparing…</div>

  <!-- Mammoth.js (DOCX → HTML ในเบราว์เซอร์) -->
  <script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>
  <script>
    // ใช้ไฟล์เดิม แค่เปลี่ยนนามสกุลเป็น .docx
    const DOCX_URL = 'files/สังคมศึกษาทุกเรื่องม.4_1-68.docx';
    const statusEl = document.getElementById('status');
    const contentEl = document.getElementById('content');

    async function loadArrayBuffer(url) {
      const res = await fetch(url, { cache: 'no-store' });
      if (!res.ok) throw new Error('โหลดไฟล์ไม่ได้: ' + res.status);
      return await res.arrayBuffer();
    }

    // map สไตล์จาก Word → HTML (หัวข้อ/หนา/เอียง)
    const options = {
      styleMap: [
        "p[style-name='Title'] => h1:fresh",
        "p[style-name='Subtitle'] => h2:fresh",
        "p[style-name='Heading 1'] => h1:fresh",
        "p[style-name='Heading 2'] => h2:fresh",
        "p[style-name='Heading 3'] => h3:fresh",
        "b => strong",
        "i => em"
      ]
    };

    function fixListSpacing(container) {
      // บังคับเว้นวรรคหลังเลขลำดับ/จุดนำหน้า และ bullet "•" (กันกรณีติดกัน)
      container.querySelectorAll('li').forEach(li => {
        li.innerHTML = li.innerHTML
          .replace(/^(\d+)\.\s?/, (_,m)=> m + '. ')
          .replace(/^•\s?/, '• ');
      });
    }

    async function renderDocx() {
      try {
        statusEl.textContent = 'Loading DOCX…';
        const buffer = await loadArrayBuffer(DOCX_URL);

        const { value: html, messages } = await window.mammoth.convertToHtml({ arrayBuffer: buffer }, options);

        contentEl.innerHTML = html;
        fixListSpacing(contentEl);

        statusEl.textContent = 'Done.';
        if (messages && messages.length) console.log('Mammoth messages:', messages);
      } catch (e) {
        console.error(e);
        statusEl.innerHTML = '<span style="color:#c00;font-weight:700">โหลดเอกสารไม่ได้ — ตรวจพาธ/ชื่อไฟล์ .docx</span>';
        contentEl.innerHTML = '';
      }
    }

    // ปุ่มดาวน์โหลด HTML ที่เรนเดอร์แล้ว
    document.getElementById('downloadHtml').addEventListener('click', () => {
      const blob = new Blob(
        [
          '<!doctype html><meta charset="utf-8"><link href="https://fonts.googleapis.com/css2?family=Niramit:wght@400;700&display=swap" rel="stylesheet">',
          '<style>body{font-family:Niramit,system-ui,-apple-system,Segoe UI,Arial,sans-serif;line-height:1.8;padding:24px;max-width:960px;margin:0 auto} h1{text-align:left;font-size:28px} h2{text-align:left;font-size:24px} h3{text-align:left;font-size:20px}</style>',
          contentEl.innerHTML
        ],
        { type: 'text/html;charset=utf-8' }
      );
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'exported.html';
      a.click();
      URL.revokeObjectURL(url);
    });

    renderDocx();
  </script>
</body>
</html>